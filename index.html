<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Coasters Tavern Digital Signage</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&family=Playfair+Display:ital,wght@0,700;1,400&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #000;
            color: #f3f4f6;
            overflow: hidden;
            margin: 0;
            padding: 0;
            cursor: none;
        }
        body.admin-mode, body:hover {
            cursor: default;
        }
        h1, h2, h3, .serif {
            font-family: 'Playfair Display', serif;
        }
        @keyframes kenburns {
            0% { transform: scale(1); }
            100% { transform: scale(1.15); }
        }
        .animate-ken-burns {
            animation: kenburns 30s infinite alternate linear;
        }
        .slide {
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
            position: absolute;
            inset: 0;
            z-index: 0;
            width: 100vw;
            height: 100vh;
            background-color: #18181b;
            pointer-events: none;
        }
        .slide.active {
            opacity: 1;
            z-index: 10;
        }
        .text-responsive-h1 { font-size: 11vh; line-height: 1.1; }
        .text-responsive-price { font-size: 14.25vh; line-height: 1; }
        .text-responsive-desc { font-size: 4vh; line-height: 1.4; }
        .text-responsive-badge { font-size: 2.75vh; letter-spacing: 0.22em; }
        
        @keyframes progress {
            0% { width: 0%; }
            100% { width: 100%; }
        }
        .animate-progress {
            animation-name: progress;
            animation-timing-function: linear;
            animation-fill-mode: forwards;
        }

        .control-btn {
            opacity: 0;
            transition: opacity 0.3s;
            cursor: pointer;
        }
        .controls-container:hover .control-btn {
            opacity: 1;
        }
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
        }
        .form-input {
            width: 100%;
            background-color: #27272a;
            border: 1px solid #3f3f46;
            border-radius: 0.5rem;
            padding: 0.5rem 1rem;
            color: white;
            outline: none;
        }
    </style>
<script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^1.36.0",
    "react": "https://esm.sh/react@^19.2.3",
    "react/": "https://esm.sh/react@^19.2.3/",
    "lucide-react": "https://esm.sh/lucide-react@^0.562.0"
  }
}
</script>
</head>
<body>
    <!-- Persistent Logo - Fixed path to images/ folder -->
    <img src="images/Coasters-Logo-Web.png" 
         id="main-logo"
         class="fixed top-[5vh] left-[5vw] w-[18vw] z-50 opacity-90 pointer-events-none drop-shadow-2xl" 
         alt="Coasters Tavern"
         onerror="this.src='https://www.coasterstavern.co.nz/wp-content/uploads/2021/07/Coasters-Logo-Web.png'">

    <div id="app" class="relative w-screen h-screen bg-black"></div>

    <!-- Interface Controls -->
    <div class="fixed top-4 right-4 z-50 flex gap-2 controls-container">
        <button id="next-btn" class="control-btn p-3 bg-white/10 hover:bg-white/20 rounded-full text-white backdrop-blur-md transition">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
        </button>
        <button id="admin-btn" class="control-btn p-3 bg-white/10 hover:bg-white/20 rounded-full text-white backdrop-blur-md transition">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
        </button>
    </div>

    <!-- Admin Modal -->
    <div id="admin-modal" class="hidden fixed inset-0 z-[100] modal-overlay flex items-center justify-center p-4">
        <div class="bg-zinc-900 border border-zinc-700 w-full max-w-2xl rounded-2xl shadow-2xl flex flex-col max-h-[90vh]">
            <div class="flex justify-between items-center p-6 border-b border-zinc-800">
                <h2 class="text-2xl font-bold text-white font-serif">Management Portal</h2>
                <button id="close-modal-btn" class="text-zinc-400 hover:text-white transition cursor-pointer">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            <div class="p-6 overflow-y-auto flex-1">
                <div class="mb-6">
                    <label class="block text-sm font-medium text-zinc-400 mb-2">Slide Selection</label>
                    <select id="day-selector" class="form-input"></select>
                </div>
                <div class="space-y-6">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-zinc-400 mb-1">Headline</label>
                            <input type="text" id="input-title" class="form-input">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-zinc-400 mb-1">Price/Callout</label>
                            <input type="text" id="input-price" class="form-input">
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between items-center mb-1">
                            <label class="block text-sm font-medium text-zinc-400">Content Body</label>
                            <button id="ai-enhance-btn" class="text-xs text-amber-500 font-bold hover:underline cursor-pointer">AI Rewrite</button>
                        </div>
                        <textarea id="input-description" rows="3" class="form-input"></textarea>
                    </div>
                </div>
            </div>
            <div class="p-6 border-t border-zinc-800 flex justify-end gap-4">
                <button id="save-btn" class="px-8 py-3 bg-amber-600 hover:bg-amber-500 text-white font-bold rounded-lg transition cursor-pointer">Update Display</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { GoogleGenAI, Type } from "@google/genai";

        const STORAGE_KEY = 'coasters_display_v6';
        const SLIDE_DURATION = 15000;
        
        // Ensure paths use images/ prefix for all backgrounds
        const INITIAL_SPECIALS = [
            { id: '1', day: 'Monday', title: "Steak Day Monday's", description: 'Enjoy a 200g Succulent Rump Steak, served with golden fries and a garden salad.', price: '$20', imageUrl: 'images/steak-night.jpg', color: '#f59e0b' },
            { id: '2', day: 'Tuesday', title: 'Chase the Ace', description: 'Draw entries start at 3:30pm. Be in to win!', price: '5.30pm', imageUrl: 'images/platter.jpg', color: '#ef4444' },
            { id: '3', day: 'Wednesday', title: 'Quiz Night', description: 'Join us for Christchurch\'s favorite quiz! Great prizes and better vibes.', price: 'FREE ENTRY', imageUrl: 'images/schnitzel.jpg', color: '#eab308' },
            { id: '4', day: 'Thursday', title: 'Burger Day', description: 'Gourmet burgers served with fries. Chicken, Beef, Fish, or Pork Belly.', price: '$19', imageUrl: 'images/burger-night.jpg', color: '#f97316' },
            { id: '5', day: 'Friday', title: 'Happy Hour', description: 'End the week right with 10% off selected beverages from 4:30pm.', price: '10% OFF', imageUrl: 'images/fish-chips.jpg', color: '#3b82f6' },
            { id: '6', day: 'Saturday', title: 'Weekend Vibes', description: 'Platters, pints, and live sport. Your local home for the big games.', price: 'FROM $35', imageUrl: 'images/platter.jpg', color: '#06b6d4' },
            { id: '7', day: 'Sunday', title: 'Two Course Roast', description: 'Traditional roast of the day with roasted vegetables and rich gravy.', price: '$28', imageUrl: 'images/roast.jpg', color: '#84cc16' },
            { id: '8', day: 'Every Day', title: 'Loyalty App', description: 'Earn points on every purchase. Join the Coasters family today.', price: 'JOIN NOW', imageUrl: 'images/platter.jpg', color: '#8b5cf6' }
        ];

        let specials = JSON.parse(localStorage.getItem(STORAGE_KEY)) || INITIAL_SPECIALS;
        let currentIndex = 0;
        let isPaused = false;
        let timer;

        const render = () => {
            const container = document.getElementById('app');
            let html = specials.map((s, i) => `
                <div class="slide ${i === currentIndex ? 'active' : ''}" style="z-index: ${i === currentIndex ? 10 : 0}">
                    <img src="${s.imageUrl}" 
                         class="w-full h-full object-cover opacity-50 animate-ken-burns"
                         onerror="this.src='https://images.unsplash.com/photo-1514362545857-3bc16c4c7d1b?auto=format&fit=crop&q=80&w=2000'">
                    <div class="absolute inset-0 bg-gradient-to-t from-black via-black/40 to-transparent"></div>
                    <div class="absolute inset-0 flex flex-col justify-center items-center text-center px-10">
                        <span class="text-responsive-badge font-bold uppercase mb-4 text-white/80 px-6 py-2 bg-black/50 backdrop-blur-sm rounded-full border-2 border-white/20">
                            ${s.day}
                        </span>
                        <h1 class="text-responsive-h1 font-bold text-white mb-6 drop-shadow-lg serif">${s.title}</h1>
                        <div class="h-1.5 w-32 mb-10 rounded-full" style="background-color: ${s.color}"></div>
                        <p class="text-responsive-desc text-white/90 max-w-5xl mb-12 font-light">${s.description}</p>
                        <div class="px-13 py-5.5 bg-black/80 border border-white/20 rounded-2xl backdrop-blur-md shadow-2xl">
                            <span class="text-responsive-price font-bold text-white tracking-tighter">${s.price}</span>
                        </div>
                    </div>
                </div>
            `).join('');
            
            html += `<div class="absolute bottom-0 left-0 w-full h-2 bg-white/10 z-50 overflow-hidden">
                <div id="pb" class="h-full bg-amber-500 animate-progress" style="animation-duration: ${SLIDE_DURATION}ms"></div>
            </div>`;
            
            container.innerHTML = html;
            
            // Re-bind the animation end event
            const pb = document.getElementById('pb');
            pb.onanimationend = () => {
                if (!isPaused) {
                    currentIndex = (currentIndex + 1) % specials.length;
                    render();
                }
            };
        };

        const initAdmin = () => {
            const selector = document.getElementById('day-selector');
            selector.innerHTML = specials.map((s, i) => `<option value="${i}">${s.day}: ${s.title}</option>`).join('');
            
            const loadFields = (idx) => {
                const s = specials[idx];
                document.getElementById('input-title').value = s.title;
                document.getElementById('input-price').value = s.price;
                document.getElementById('input-description').value = s.description;
            };

            selector.onchange = (e) => loadFields(e.target.value);
            loadFields(0);

            document.getElementById('admin-btn').onclick = () => {
                isPaused = true;
                document.body.classList.add('admin-mode');
                document.getElementById('admin-modal').classList.remove('hidden');
                document.getElementById('pb').style.animationPlayState = 'paused';
            };

            document.getElementById('close-modal-btn').onclick = () => {
                isPaused = false;
                document.body.classList.remove('admin-mode');
                document.getElementById('admin-modal').classList.add('hidden');
                render();
            };

            document.getElementById('save-btn').onclick = () => {
                const idx = document.getElementById('day-selector').value;
                specials[idx].title = document.getElementById('input-title').value;
                specials[idx].price = document.getElementById('input-price').value;
                specials[idx].description = document.getElementById('input-description').value;
                localStorage.setItem(STORAGE_KEY, JSON.stringify(specials));
                alert('Saved! Restarting slideshow.');
                render();
            };

            document.getElementById('next-btn').onclick = () => {
                currentIndex = (currentIndex + 1) % specials.length;
                render();
            };

            document.getElementById('ai-enhance-btn').onclick = async () => {
                const btn = document.getElementById('ai-enhance-btn');
                const original = btn.innerText;
                btn.innerText = 'Analyzing...';
                try {
                    const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });
                    const prompt = `Rewrite this menu item to be more enticing. 
                        Title: ${document.getElementById('input-title').value}
                        Original: ${document.getElementById('input-description').value}`;
                    
                    const res = await ai.models.generateContent({
                        model: 'gemini-3-flash-preview',
                        contents: prompt,
                        config: {
                            responseMimeType: 'application/json',
                            responseSchema: {
                                type: Type.OBJECT,
                                properties: {
                                    title: { type: Type.STRING },
                                    description: { type: Type.STRING }
                                }
                            }
                        }
                    });
                    const data = JSON.parse(res.text);
                    document.getElementById('input-title').value = data.title;
                    document.getElementById('input-description').value = data.description;
                } catch (e) {
                    console.error(e);
                    alert('AI Error.');
                } finally {
                    btn.innerText = original;
                }
            };
        };

        // Initialize on load
        window.addEventListener('load', () => {
            render();
            initAdmin();
        });
    </script>
</body>
</html>